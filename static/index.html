<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Node-SDR</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		:root {
			--primary-red: #ff4a4a;
			--faded-grey: #777
		}
		body {
			font-family: "Chivo-Regular", "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", "Helvetica", "Arial", sans-serif;
		}

		.tuner {
			display: flex;
			flex-direction: column;
			align-items: center;
			max-width: 320px;
			border: 2px solid;
			padding: 12px;
		}

		label {
			text-align: center;
   			font-weight: bold;
		}

		input {
			font-size: 2rem;
			border: 2px solid;
			margin: 1rem;
		}

		#tune {
			border: 1px solid var(--primary-red);
			color: white;
			background-color: var(--primary-red);
			font-size: 1.4rem;
			border-radius: 4px;
			display: inline-block;
			padding: 8px 32px;
		}

		audio {
			margin: 1rem 0;
		}
	</style>
</head>
<body>
	<div class="tuner">
		<label for="freq">Select A Frequency<br>(24 - 1766)</label>
		<input type='number' min="24" max="1766" step="0.1" id="freq"/>
		<button id="tune">Tune In</button>
	</div>

	<audio controls="controls" type="audio/ogg"></audio>


	<script>
		let tuneButton = document.querySelector("#tune");
		let a = document.querySelector("audio");
		const srcURL = 'http://206.189.18.163:8000/vorbis';
		let started = false;

		a.addEventListener("loadeddata", () => {
			console.log("Loaded Data");
		});

		document.addEventListener("DOMContentLoaded", () => {
			console.log("Loaded");
			fetch(srcURL)
				.then(data => data.status)
				.then(status => {
					if (status === 200) {
						a.src = srcURL;
					}
				});
		});

		tuneButton.addEventListener("click", () => {
			let f = document.getElementById("freq").value;
			let data = {
				freq: f
			};
			
			fetch(`/radio`, {
				method: 'post',
				headers: {
					'Content-Type': 'application/json'
				},
				cache: "no-store",
				body: JSON.stringify(data)
			})
				.then(res => res.text())
				.then(text => {
					console.log(text);
					if (text.includes("ready")) {
						if (!started) started = true;
						if (a.src) a.src = null;
						a.src = srcURL;
						a.play();
					}
				});
		});
	</script>
</body>
</html>