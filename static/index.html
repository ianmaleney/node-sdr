<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Node-SDR</title>
</head>
<body>
    <h1>Test</h1>
	<label for="freq">Select Frequency</label>
	<input type='number' min="20" max="150" step="0.1" id="freq"/>
	<button id="tune">Send Message</button>
	<audio controls="controls" type="audio/ogg"></audio>
	<h2></h2>
	<script>
		let tuneButton = document.querySelector("#tune");
		let a = document.querySelector("audio");
		let started = false;

		a.addEventListener("loadeddata", () => {
			console.log("Loaded Data");
		});

		tuneButton.addEventListener("click", () => {
			let f = document.getElementById("freq").value;
			let data = {
				freq: f
			};
			const srcURL = 'http://206.189.18.163:8000/vorbis';
			fetch(`/radio`, {
				method: 'post',
				headers: {
					'Content-Type': 'application/json'
				},
				cache: "no-store",
				body: JSON.stringify(data)
			})
				.then(res => res.text())
				.then(text => {
					console.log(text);
					if (text.includes("ready")) {
						if (!started) started = true;
						if (a.src) a.src = null;
						a.src = srcURL;
						a.play();
					}
				});
		});
	</script>
</body>
</html>