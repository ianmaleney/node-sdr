<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Node-SDR</title>
</head>
<body>
    <h1>Test</h1>
	<label for="freq">Select Frequency</label>
	<input type='number' min="20" max="150" step="0.1" id="freq"/>
	<button id="tune">Send Message</button>
	<audio controls="controls" type="audio/ogg"></audio>
	<h2></h2>
	<script>
		let tuneButton = document.querySelector("#tune");
		let a = document.querySelector("audio");
		let started = false;

		tuneButton.addEventListener("click", () => {
			let f = document.getElementById("freq").value;
			// fetch(`/radio?freq=${f}`).then(res => console.log(res));
			const socketProtocol = (window.location.protocol === 'https:' ? 'wss:' : 'ws:')
			const url = socketProtocol + '//' + window.location.hostname + ':3000/echo/';
			const srcURL = 'http://' + window.location.hostname + ':8000/vorbis';
			const connection = new WebSocket(url);
			connection.onopen = () => {
				connection.send(f);
			}
			connection.onerror = error => {
				console.log(`WebSocket error: ${error}`)
			}
			connection.onmessage = e => {
				console.log(e.data);
				document.querySelector("h2").innerHTML = e.data;
				if (e.data.includes("Sampling at") && !started) {
					started = true;
					a.src = srcURL;
					a.play();
				}
			}
		});
	</script>
</body>
</html>